import { __assign, __awaiter, __generator } from "tslib";
import { AssumeRoleCommand, STSClient } from "@aws-sdk/client-sts";
import { CredentialsProviderError } from "@aws-sdk/property-provider";
export var fromTemporaryCredentials = function (options) {
    var stsClient;
    return function () { return __awaiter(void 0, void 0, void 0, function () {
        var params, _a, Credentials;
        var _b;
        return __generator(this, function (_c) {
            switch (_c.label) {
                case 0:
                    params = __assign(__assign({}, options.params), { RoleSessionName: (_b = options.params.RoleSessionName) !== null && _b !== void 0 ? _b : "aws-sdk-js-" + Date.now() });
                    if (!(params === null || params === void 0 ? void 0 : params.SerialNumber)) return [3, 2];
                    if (!options.mfaCodeProvider) {
                        throw new CredentialsProviderError("Temporary credential requires multi-factor authentication," + " but no MFA code callback was provided.", false);
                    }
                    _a = params;
                    return [4, options.mfaCodeProvider(params === null || params === void 0 ? void 0 : params.SerialNumber)];
                case 1:
                    _a.TokenCode = _c.sent();
                    _c.label = 2;
                case 2:
                    if (!stsClient)
                        stsClient = new STSClient(__assign(__assign({}, options.clientConfig), { credentials: options.masterCredentials }));
                    return [4, stsClient.send(new AssumeRoleCommand(params))];
                case 3:
                    Credentials = (_c.sent()).Credentials;
                    if (!Credentials || !Credentials.AccessKeyId || !Credentials.SecretAccessKey) {
                        throw new CredentialsProviderError("Invalid response from STS.assumeRole call with role ".concat(params.RoleArn));
                    }
                    return [2, {
                            accessKeyId: Credentials.AccessKeyId,
                            secretAccessKey: Credentials.SecretAccessKey,
                            sessionToken: Credentials.SessionToken,
                            expiration: Credentials.Expiration,
                        }];
            }
        });
    }); };
};
